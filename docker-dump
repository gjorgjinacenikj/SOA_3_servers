  users:
    build:
      context: ./Users
    stdin_open: true
    tty: true
    image: users-fastapi:latest
    depends_on:
      - keycloak
    ports:
      - "7004:80"
    environment:
      MODULE_NAME: users
      DOCKER_HOST: keycloak
      SERVICE_3000_CHECK_HTTP: "/"
      SERVICE_3000_CHECK_INTERVAL: "15s"
      SERVICE_3000_CHECK_TIMEOUT: "1s"
      SERVICE_3000_CHECK_DEREGISTER_AFTER: "10m"
    restart: on-failure



  '''
  keycloak-db:
    container_name: keycloak-db
    image: postgres:latest
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB:       keycloak_database
      POSTGRES_USER:     postgres
      POSTGRES_PASSWORD: password
    restart: always

  keycloak:
    container_name: keycloak
    image: jboss/keycloak:8.0.1
    depends_on:
      - keycloak-db
    ports:
      - "8180:8080"
      - "9990:9990"
    environment:
      DB_VENDOR:   POSTGRES
      DB_ADDR:     keycloak-db
      DB_PORT:     5432
      DB_DATABASE: keycloak_database
      DB_USER:     postgres
      DB_PASSWORD: password
      KEYCLOAK_USER:     admin
      KEYCLOAK_PASSWORD: password
      KEYCLOAK_LOGLEVEL: DEBUG
    restart: on-failure



  api:
    image: api
    build: ./api
    container_name: exaaample_api
    ports:
      - "5001:5000"
    restart: always
    volumes:
      - ./api:/app
    environment:
      KEYCLOAK_URI: http://keycloak:8180/auth/
      REALM: users_realm
      CLIENT_ID: myapp
      CLIENT_SECRET: 5f17b121-ce94-4ab1-b308-7bd0eb05fdc4
      OPENID_URL: http://keycloak:8180/auth/realms/users_realm/protocol/openid-connect
      ADMIN_USER: admin
      ADMIN_PASS: password



